# 智能问数项目API接口文档

## 项目概述

智能问数是一个面向业务用户的智能数据服务平台，通过自然语言交互、知识管理及工具配置，提供数据问答、知识沉淀与智能体体验功能，提升业务决策效率。

## 技术架构

- **后端**: Spring Boot + MySQL
- **前端**: Vue3
- **AI模型**: 集成大模型接口进行自然语言转SQL
- **数据库**: 支持多种数据库类型（MySQL、PostgreSQL、Oracle等）

## API接口列表

### 1. 数据问答模块

#### 1.1 数据问答接口
- **接口地址**: `POST /api/data-question/ask`
- **功能描述**: 支持自然语言查询数据库，将用户问题转换为SQL并执行
- **请求参数**:
  ```json
  {
    "sessionId": "会话ID",
    "question": "查询问题",
    "dbConfigId": "数据库配置ID",
    "tableId": "表ID或表名"
  }
  ```
- **响应格式**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "success": true,
      "result": "查询结果",
      "resultType": "table/text",
      "sql": "执行的SQL语句",
      "bottomReply": "兜底回复内容"
    }
  }
  ```

#### 1.2 数据库状态调试接口
- **接口地址**: `GET /api/data-question/debug/db-status/{dbConfigId}`
- **功能描述**: 检查数据库和表的状态信息
- **响应格式**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "dbConfig": "数据库配置信息",
      "allTablesCount": "总表数量",
      "enabledTablesCount": "启用表数量",
      "tableDetails": "详细表信息"
    }
  }
  ```

### 2. 数据库配置模块

#### 2.1 保存数据库配置
- **接口地址**: `POST /api/db/config`
- **功能描述**: 创建或更新数据库连接配置
- **请求参数**:
  ```json
  {
    "name": "配置名称",
    "dbType": "数据库类型",
    "host": "主机地址",
    "port": "端口号",
    "databaseName": "数据库名",
    "username": "用户名",
    "password": "密码"
  }
  ```

#### 2.2 获取数据库配置
- **接口地址**: `GET /api/db/config/{id}`
- **功能描述**: 根据ID获取数据库配置详情

#### 2.3 获取数据库配置列表
- **接口地址**: `GET /api/db/configs`
- **功能描述**: 分页获取数据库配置列表
- **请求参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `name`: 配置名称（可选）
  - `host`: 主机地址（可选）

#### 2.4 验证数据库连接
- **接口地址**: `POST /api/db/config/{id}/verify`
- **功能描述**: 测试数据库连接是否正常

### 3. 聊天对话模块

#### 3.1 测试Dify API连接
- **接口地址**: `GET /api/chat/test-dify`
- **功能描述**: 测试与Dify AI服务的连接状态

#### 3.2 创建聊天会话
- **接口地址**: `POST /api/chat/session`
- **功能描述**: 创建新的聊天会话

#### 3.3 获取聊天会话列表
- **接口地址**: `GET /api/chat/sessions`
- **功能描述**: 获取用户的聊天会话列表

#### 3.4 发送聊天消息
- **接口地址**: `POST /api/chat/message`
- **功能描述**: 发送聊天消息并获取AI回复

### 4. 知识管理模块

#### 4.1 获取知识库列表
- **接口地址**: `GET /knowledge/list`
- **功能描述**: 分页获取知识库列表
- **请求参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `name`: 知识库名称（可选）

#### 4.2 创建知识库
- **接口地址**: `POST /knowledge/create`
- **功能描述**: 创建新的知识库
- **请求参数**:
  ```json
  {
    "name": "知识库名称",
    "description": "知识库描述",
    "type": "知识库类型"
  }
  ```

#### 4.3 获取知识库详情
- **接口地址**: `GET /knowledge/{id}`
- **功能描述**: 根据ID获取知识库详细信息

#### 4.4 更新知识库
- **接口地址**: `PUT /knowledge/update`
- **功能描述**: 更新知识库信息

#### 4.5 删除知识库
- **接口地址**: `DELETE /knowledge/{id}`
- **功能描述**: 删除指定的知识库

#### 4.6 上传知识文件
- **接口地址**: `POST /knowledge/upload`
- **功能描述**: 上传文档到知识库进行解析和嵌入

#### 4.7 知识库问答
- **接口地址**: `POST /knowledge/qa`
- **功能描述**: 基于知识库内容进行问答

### 5. 工具管理模块

#### 5.1 获取工具列表
- **接口地址**: `GET /tool/list`
- **功能描述**: 分页获取工具配置列表
- **请求参数**:
  - `current`: 当前页码
  - `size`: 每页大小
  - `name`: 工具名称（可选）
  - `status`: 工具状态（可选）

#### 5.2 添加工具
- **接口地址**: `POST /tool/add`
- **功能描述**: 添加新的工具配置
- **请求参数**:
  ```json
  {
    "name": "工具名称",
    "type": "工具类型",
    "config": "工具配置",
    "status": "启用状态"
  }
  ```

#### 5.3 更新工具
- **接口地址**: `PUT /tool/update`
- **功能描述**: 更新工具配置信息

#### 5.4 删除工具
- **接口地址**: `DELETE /tool/{id}`
- **功能描述**: 删除指定的工具配置

#### 5.5 获取工具详情
- **接口地址**: `GET /tool/{id}`
- **功能描述**: 根据ID获取工具详细信息

### 6. 开放API模块

#### 6.1 数据问答API
- **接口地址**: `POST /open-api/v1/query/{apiPath}`
- **功能描述**: 对外提供的数据问答API接口
- **请求参数**:
  ```json
  {
    "apiKey": "API密钥",
    "question": "查询问题",
    "parameters": "额外参数（可选）"
  }
  ```
- **响应格式**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "result": "查询结果",
      "sql": "执行的SQL",
      "executionTime": "执行时间"
    }
  }
  ```

#### 6.2 创建API配置
- **接口地址**: `POST /open-api/v1/config`
- **功能描述**: 创建新的API配置
- **请求参数**:
  ```json
  {
    "name": "API名称",
    "apiPath": "API路径",
    "dbConfigId": "数据库配置ID",
    "tableId": "表ID",
    "rateLimit": "频率限制",
    "status": "启用状态"
  }
  ```

#### 6.3 获取API配置列表
- **接口地址**: `GET /open-api/v1/configs`
- **功能描述**: 获取API配置列表

#### 6.4 更新API配置
- **接口地址**: `PUT /open-api/v1/config/{id}`
- **功能描述**: 更新API配置信息

#### 6.5 删除API配置
- **接口地址**: `DELETE /open-api/v1/config/{id}`
- **功能描述**: 删除指定的API配置

### 7. 用户管理模块

#### 7.1 用户登录
- **接口地址**: `POST /api/user/login`
- **功能描述**: 用户登录认证

#### 7.2 用户注册
- **接口地址**: `POST /api/user/register`
- **功能描述**: 新用户注册

#### 7.3 获取用户信息
- **接口地址**: `GET /api/user/info`
- **功能描述**: 获取当前用户信息

#### 7.4 更新用户信息
- **接口地址**: `PUT /api/user/update`
- **功能描述**: 更新用户个人信息

### 8. 系统管理模块

#### 8.1 获取系统状态
- **接口地址**: `GET /api/system/status`
- **功能描述**: 获取系统运行状态

#### 8.2 获取系统配置
- **接口地址**: `GET /api/system/config`
- **功能描述**: 获取系统配置信息

## 通用响应格式

所有API接口都使用统一的响应格式：

```json
{
  "code": 200,
  "message": "success",
  "data": "响应数据"
}
```

### 状态码说明

- `200`: 请求成功
- `400`: 请求参数错误
- `401`: 未授权访问
- `403`: 访问被禁止
- `404`: 资源不存在
- `429`: 请求频率超限
- `500`: 服务器内部错误

## 安全特性

1. **API密钥认证**: 开放API接口需要有效的API密钥
2. **频率限制**: 支持配置API调用频率限制
3. **数据加密**: 敏感数据（如数据库密码）进行加密存储
4. **权限控制**: 用户数据隔离，确保数据安全

## 错误处理

系统提供详细的错误信息，包括：
- 参数验证错误
- 数据库连接错误
- AI模型调用错误
- 权限验证错误

## 性能优化

1. **缓存机制**: 使用Redis缓存热点数据
2. **异步处理**: 支持异步处理长时间运行的任务
3. **连接池**: 数据库连接池优化
4. **超时控制**: 设置合理的超时时间

## 部署说明

1. **环境要求**: JDK 17+, MySQL 8.0+
2. **配置文件**: 修改 `application.yml` 中的数据库连接信息
3. **启动命令**: `java -jar mt-agent-workflow-api-core.jar`
4. **访问地址**: `http://localhost:8080`

## 开发指南

1. **API文档**: 使用Swagger自动生成API文档
2. **日志记录**: 使用SLF4J进行日志记录
3. **异常处理**: 统一的异常处理机制
4. **代码规范**: 遵循阿里巴巴Java开发手册

---

*本文档基于智能问数项目当前版本生成，如有更新请参考最新代码。*

